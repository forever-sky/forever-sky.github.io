<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>等保</title>
      <link href="/2022/03/06/%E7%AD%89%E4%BF%9D/"/>
      <url>/2022/03/06/%E7%AD%89%E4%BF%9D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="等保"><a href="#等保" class="headerlink" title="等保"></a>等保</h1><blockquote></blockquote><h2 id="0x01-测评流程"><a href="#0x01-测评流程" class="headerlink" title="0x01 测评流程"></a>0x01 测评流程</h2><h3 id="一、商务（合同签订）"><a href="#一、商务（合同签订）" class="headerlink" title="一、商务（合同签订）"></a>一、商务（合同签订）</h3><h3 id="二、测评"><a href="#二、测评" class="headerlink" title="二、测评"></a>二、测评</h3><ul><li>确定测试方式：远程、现场 （能有测试环境就要测试环境，能远程就远程）</li><li><strong>授权书</strong>（1、有测试环境【必要】 2、<strong>没有测试环境</strong>【非常必要】）</li><li>调研表（完整报告里的信息需要客户填写的部分）</li><li>登录扫描 or 非登录扫描 （给不给账号）</li><li>渗透测试</li><li>安全功能测试</li><li>总结问题</li><li>反馈给客户</li><li>客户整改</li><li>复测（等待客户整改完成后进行）</li><li>出具报告</li></ul><h4 id="应用安全测试项"><a href="#应用安全测试项" class="headerlink" title="应用安全测试项"></a>应用安全测试项</h4><p>询问+自测<br>询问条例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1、用户密码登录，密码是否有复杂度要求，具体复杂度为？是否有定期更换要求？</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">2、系统登录是否有多次登录失败后的帐户锁定功能，且登录空闲超时退出时间为多久？</span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line">3、用户登录密码或重要个人信息等传输过程中是否进行了加密，加密算法为？</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">4、系统提供了基于角色给用户分配权限，还是其他的方式如岗位&#x2F;部门，又或者直接赋予权限？</span><br><span class="line">  </span><br><span class="line">   </span><br><span class="line">5、系统是否存在默认账户，是否存在默认密码，具体默认账户、默认密码为多少？</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">6、系统是否存在系统管理员、安全管理员、审计管理员这样的三权分立，具体用户名为多少？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7、系统界面是否存在日志功能模块，日志功能具体记录哪些类型日志（可截图说明）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8、各日志类型分别具体记录哪些用户行为，各日志类型记录的字段信息是哪些（可截图说明）【网站后台记录的日志】</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9、各日志信息是否有备份或syslog发送至其他地方以进行保存</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">10、系统重要数据是否采用SHA-2等密码算法或SSL（HTTPS）协议传输以保证数据在通信过程中的完整性？</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">11、系统数据库数据及软件代码的备份策略具体为？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">12、系统数据库数据及软件代码是否定时备份至异地备用场地，异地备用场地具体为？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">13、系统是否采集和保存业务必需的用户个人信息？</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">14、授权访问和使用用户个人信息是否严格限制，且仅允许什么权限用户访问？</span><br></pre></td></tr></table></figure><ul><li>数据备份恢复<br>询问：<br>系统数据库设置 XXXX时间，进行xxx备份类型，备份至XXX，备份是否正常？</li><li></li></ul><h2 id="0x02-报告编写"><a href="#0x02-报告编写" class="headerlink" title="0x02 报告编写"></a>0x02 报告编写</h2><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>漏扫系统的版本有新的更新（安恒明鉴WEB应用弱点扫描器6.0（设备编号：000107，漏洞版本V6.1.118）、绿盟RSAS远程安全评估系统V6.0（设备编号：000500，漏洞库版本V6.0R04F01SP02））</p><p>工具箱的版本也更新过了（网络安全等级保护检查工具箱 2.1.0.3.9）</p><h2 id="0x03-策略要求"><a href="#0x03-策略要求" class="headerlink" title="0x03 策略要求"></a>0x03 策略要求</h2><blockquote><p><a href="https://blog.bwcxtech.com/posts/997246a0/" target="_blank" rel="noopener">linux与等保那些事</a><br><a href="http://t.zoukankan.com/hai-long-p-14591854.html" target="_blank" rel="noopener">mysql数据库登录失败锁定策略的设置</a></p></blockquote><h3 id="Linux策略要求"><a href="#Linux策略要求" class="headerlink" title="Linux策略要求"></a>Linux策略要求</h3><p>sudo useradd -r -m -s /bin/bash zdjy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">allow_remote_ip=192.168.8.18</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 口令复杂度 定期</span></span><br><span class="line">apt-get install libpam-cracklib -y</span><br><span class="line"></span><br><span class="line">sed -ri <span class="string">'/^password\s.+pam_cracklib.so/&#123;s/pam_cracklib.so\s+\w+.*$/pam_cracklib.so retry=3 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 difok=1/g;&#125;'</span> /etc/pam.d/common-password</span><br><span class="line">egrep -q <span class="string">"^\s*PASS_MIN_DAYS\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_MIN_DAYS\s+\S*(\s*#.*)?\s*$/\PASS_MIN_DAYS  1/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_MIN_DAYS  1"</span> &gt;&gt; /etc/login.defs</span><br><span class="line">egrep -q <span class="string">"^\s*PASS_MAX_DAYS\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_MAX_DAYS\s+\S*(\s*#.*)?\s*$/\PASS_MAX_DAYS  180/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_MAX_DAYS  180"</span> &gt;&gt; /etc/login.defs</span><br><span class="line">egrep -q <span class="string">"^\s*PASS_WARN_AGE\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_WARN_AGE\s+\S*(\s*#.*)?\s*$/\PASS_WARN_AGE  7/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_WARN_AGE  7"</span> &gt;&gt; /etc/login.defs</span><br><span class="line">egrep -q <span class="string">"^\s*PASS_MIN_LEN\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_MIN_LEN\s+\S*(\s*#.*)?\s*$/\PASS_MIN_LEN  8/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_MIN_LEN  8"</span> &gt;&gt; /etc/login.defs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录失败</span></span><br><span class="line">sed -ri <span class="string">'2a auth required pam_tally2.so deny=3 unlock_time=600 even_deny_root root_unlock_time=1800'</span> /etc/pam.d/sshd</span><br><span class="line">sed -ri <span class="string">'2a auth required pam_tally2.so deny=3 unlock_time=600 even_deny_root root_unlock_time=1800'</span> /etc/pam.d/login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 超时</span></span><br><span class="line">egrep -q <span class="string">"^\s*(export|)\s*TMOUT\S\w+.*$"</span> /etc/profile &amp;&amp; sed -ri <span class="string">"s/^\s*(export|)\s*TMOUT.\S\w+.*$/export TMOUT=1800\nreadonly TMOUT/"</span> /etc/profile || <span class="built_in">echo</span> <span class="string">"export TMOUT=1800\nreadonly TMOUT"</span> &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># root禁止远程</span></span><br><span class="line">egrep -q <span class="string">"^\s*PermitRootLogin\s+.+$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^\s*PermitRootLogin\s+.+$/PermitRootLogin no/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"PermitRootLogin no"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo </span></span><br><span class="line">sed -i <span class="string">"/# User pri/i zdjy    ALL=(ALL) PASSWD:ALL"</span> /etc/sudoers</span><br><span class="line">sed -i <span class="string">"/root    ALL=(ALL:ALL) ALL/i # root   ALL=(ALL:ALL) ALL"</span> /etc/sudoers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问地址限制</span></span><br><span class="line"><span class="built_in">echo</span> sshd:<span class="variable">$allow_remote_ip</span>:allow &gt;&gt; /etc/hosts.allow</span><br><span class="line"><span class="built_in">echo</span> all:all &gt;&gt; /etc/hosts.deny</span><br></pre></td></tr></table></figure><h4 id="具有口令复杂度"><a href="#具有口令复杂度" class="headerlink" title="具有口令复杂度"></a>具有口令复杂度</h4><p>（大小写字母、数字、特殊字符），至少8位以上，180天定期更换    (<a href="mailto:Qwer49476600@qq.com">Qwer49476600@qq.com</a>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Debian和Ubuntu系统，更改&#x2F;etc&#x2F;pam.d&#x2F;common-password</span><br><span class="line">ubuntu没有默认安装cracklib PAM模块。  apt-get install libpam-cracklib</span><br><span class="line"></span><br><span class="line">CentOS 7和其他派生产品，修改&#x2F;etc&#x2F;pam.d&#x2F;system-auth或&#x2F;etc&#x2F;security&#x2F;pwquality.conf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/etc/pam.d/common-password文件更改内容</span><br><span class="line">minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1</span><br><span class="line"><span class="comment"># ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 表示最少有一个大写字母，最少一个小写字母，最少一个数字，最少一个特殊字符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Centos /etc/pam.d/system-auth文件更改内容</span><br><span class="line">password requisite pam_cracklib.so retry=5 difok=3 minlen=10 ucredit=-1 lcredit=-3 dcredit=-3 dictpath=/usr/share/cracklib/pw_dict</span><br><span class="line"></span><br><span class="line">vim /etc/login.defs</span><br><span class="line"><span class="comment"># 密码最大有效期 </span></span><br><span class="line">PASS_MAX_DAYS 180 </span><br><span class="line"><span class="comment"># 两次修改密码的最小间隔时间 </span></span><br><span class="line">PASS_MIN_DAYS 1 </span><br><span class="line"><span class="comment"># 密码最小长度，对于root无效 </span></span><br><span class="line">PASS_MIN_LEN 8 </span><br><span class="line"><span class="comment"># 密码过期前 7 天开始提示 </span></span><br><span class="line">PASS_WARN_AGE 7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以下命令可以更改指定用户，比如你安装插件前的系统普通用户定期更换</span><br><span class="line">chage -E 6/30/2022 -m 5 -M 180 -I 30 -W 14 zdjy</span><br><span class="line"><span class="comment">#将密码期限设为2021年6月3日。另外，修改密码的最短周期为5天，最长周期为180天。密码过期前14天会发送消息提醒用户，过期后帐号会被锁住30天</span></span><br></pre></td></tr></table></figure><p>自动化替换指定值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">!<span class="comment">#/bin/bash  </span></span><br><span class="line">​  </span><br><span class="line">apt-get install libpam-cracklib -y  </span><br><span class="line">​  </span><br><span class="line">sed -ri <span class="string">'20,30s@pam_cracklib.so.*@pam_cracklib.so retry=3 minlen=10 difok=3 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1@g'</span> /etc/pam.d/common-password  </span><br><span class="line">​  </span><br><span class="line">sed -ri <span class="string">'20,30s@pam_unix.so.*@ pam_unix.so obscure use_authtok try_first_pass sha512 remember=5@g'</span> /etc/pam.d/common-password  </span><br><span class="line">​  </span><br><span class="line">sed -ri <span class="string">'160,162s@PASS_MAX_DAYS.*@PASS_MAX_DAYS   180@g'</span> /etc/login.defs  </span><br><span class="line">​  </span><br><span class="line">sed -ri <span class="string">'160,162s@PASS_MIN_DAYS.*@PASS_MIN_DAYS   1@g'</span> /etc/login.defs  </span><br><span class="line">​  </span><br><span class="line">sed -ri <span class="string">'160,162s@PASS_WARN_AGE.*@PASS_WARN_AGE   14@g'</span> /etc/login.defs</span><br></pre></td></tr></table></figure><p>查找替换后的值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -Ev <span class="string">"^$|^[#;]"</span> /etc/pam.d/common-password   </span><br><span class="line">grep -Ev <span class="string">"^$|^[#;]"</span> /etc/login.defs | grep PASS</span><br></pre></td></tr></table></figure><hr><h4 id="普通用户登录失败3次后锁定600s，root锁定1800s"><a href="#普通用户登录失败3次后锁定600s，root锁定1800s" class="headerlink" title="普通用户登录失败3次后锁定600s，root锁定1800s"></a>普通用户登录失败3次后锁定600s，root锁定1800s</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">本地终端登录</span><br><span class="line">sudo vim /etc/pam.d/login</span><br><span class="line">远程ssh</span><br><span class="line">sudo vim /etc/pam.d/sshd</span><br><span class="line"></span><br><span class="line">添加下行</span><br><span class="line">auth required pam_tally2.so deny=3 unlock_time=600 even_deny_root root_unlock_time=1800</span><br></pre></td></tr></table></figure><hr><h4 id="超时退出时间1800s"><a href="#超时退出时间1800s" class="headerlink" title="超时退出时间1800s"></a>超时退出时间1800s</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#针对指定用户设置, 首先进入用户的家目录, 修改 .bash_profile 文件, 300秒;</span></span><br><span class="line"><span class="built_in">cd</span> /home/zdjy</span><br><span class="line">ls -a</span><br><span class="line">    .  ..  .bash_history  .bash_logout  .bash_profile  .bashrc</span><br><span class="line">vim .bash_profile</span><br><span class="line">    <span class="built_in">export</span> TMOUT=1800</span><br><span class="line"><span class="comment">#修改 /etc/profile 文件, 全局所有用户生效;</span></span><br><span class="line"></span><br><span class="line">vim /etc/profile</span><br><span class="line">    ... ...</span><br><span class="line">    <span class="built_in">export</span> TMOUT=1800</span><br><span class="line"><span class="built_in">readonly</span> TMOUT</span><br><span class="line"><span class="built_in">source</span> /etc/profile                <span class="comment">#声明生效, 或者退出终端重新登录生效;</span></span><br></pre></td></tr></table></figure><hr><h4 id="root用户禁止远程登录"><a href="#root用户禁止远程登录" class="headerlink" title="root用户禁止远程登录"></a>root用户禁止远程登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">将PermitRootLogin设置为no</span><br><span class="line">vim &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line"></span><br><span class="line">service ssh restart  or   &#x2F;etc&#x2F;init.d&#x2F;sshd restart</span><br></pre></td></tr></table></figure><hr><h4 id="开启审计进程，配置审计规则"><a href="#开启审计进程，配置审计规则" class="headerlink" title="开启审计进程，配置审计规则"></a>开启审计进程，配置审计规则</h4><ul><li>启用 auditd 服务</li><li>启用 rsyslog 或 syslog-ng 服务</li><li>确保收集用户的文件删除事件</li><li>确保收集对系统管理范围（sudoers）的更改</li><li>确保收集修改用户/组信息的事件 如使用了第三方日志收集服务，可自行举证并忽略此项。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启用 auditd 服务</span></span><br><span class="line">systemctl start auditd</span><br><span class="line"></span><br><span class="line"><span class="comment">#启用rsyslog</span></span><br><span class="line">systemctl start rsyslog</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加到`/etc/audit/rules.d/audit.rules`和`/etc/audit/audit.rules`  确保收集用户的文件删除事件 ，</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete</span><br><span class="line">-a always,<span class="built_in">exit</span> -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加到`/etc/audit/rules.d/audit.rules`和`/etc/audit/audit.rules` 确保收集对系统管理范围（sudoers）的更改</span></span><br><span class="line">-w /etc/group -p wa -k identity </span><br><span class="line">-w /etc/passwd -p wa -k identity </span><br><span class="line">-w /etc/gshadow -p wa -k identity </span><br><span class="line">-w /etc/shadow -p wa -k identity </span><br><span class="line">-w /etc/security/opasswd -p wa -k identity</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加到`/etc/audit/rules.d/audit.rules`和`/etc/audit/audit.rules` 确保收集对系统管理范围（sudoers）的更改</span></span><br><span class="line">-w /etc/sudoers -p wa -k scope</span><br><span class="line">-w /etc/sudoers.d/ -p wa -k scope</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启auditd</span></span><br><span class="line">systemctl restart auditd</span><br></pre></td></tr></table></figure><hr><h4 id="安装杀毒软件，并定期更新病毒库和每周一进行查杀"><a href="#安装杀毒软件，并定期更新病毒库和每周一进行查杀" class="headerlink" title="安装杀毒软件，并定期更新病毒库和每周一进行查杀"></a>安装杀毒软件，并定期更新病毒库和每周一进行查杀</h4><ul><li>安装clamav  （会自动创建名为clamav的用户，会一直自动升级）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install clamav</span><br></pre></td></tr></table></figure></li><li>/etc/clamav/freshclam.conf添加升级服务器镜像<figure class="highlight plain"><figcaption><span>db.cn.clamav.net```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- crontab -e 添加到最后一行</span><br><span class="line"></span><br><span class="line">sudo select-editor 修改编辑器为vim</span><br><span class="line">&#96;&#96;&#96;text</span><br><span class="line">0 17 * * 1 clamscan --infected -r &#x2F; --remove -l &#x2F;var&#x2F;log&#x2F;clamscan.log</span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="sudo权限仅zdjy用户可以使用"><a href="#sudo权限仅zdjy用户可以使用" class="headerlink" title="sudo权限仅zdjy用户可以使用"></a>sudo权限仅zdjy用户可以使用</h4><blockquote><p>参考 <a href="https://segmentfault.com/a/1190000007394449?utm_source=tag-newest" target="_blank" rel="noopener">sudoers的深入剖析</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sudoers</span><br><span class="line"></span><br><span class="line">zdjy ALL=(ALL) PASSWD:ALL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#用户账号 可以从哪里登录=（可以切换的身份） 可以执行的命令，要使用绝对路径</span></span><br></pre></td></tr></table></figure><h4 id="设置访问地址限制，仅允许1个IP才能访问"><a href="#设置访问地址限制，仅允许1个IP才能访问" class="headerlink" title="设置访问地址限制，仅允许1个IP才能访问"></a>设置访问地址限制，仅允许1个IP才能访问</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts.allow 添加</span><br><span class="line">sshd:192.168.1.3</span><br><span class="line"></span><br><span class="line">vim /etc/hosts.deny 添加</span><br><span class="line">sshd:all</span><br></pre></td></tr></table></figure><h3 id="Mysql策略要求"><a href="#Mysql策略要求" class="headerlink" title="Mysql策略要求"></a>Mysql策略要求</h3><p><a href="mailto:Qwer49476600@qq.com">Qwer49476600@qq.com</a><br>/etc/mysql/my.cnf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">require_secure_transport = ON</span><br><span class="line"><span class="built_in">bind</span>-address = 0.0.0.0</span><br><span class="line">plugin-load-add=validate_password.so</span><br><span class="line">validate-password=ON</span><br><span class="line">validate_password_policy = 1</span><br><span class="line">validate_password_length = 8</span><br><span class="line">validate_password_mixed_case_count = 1</span><br><span class="line">validate_password_number_count = 2</span><br><span class="line">validate_password_special_char_count = 1</span><br><span class="line">default_password_lifetime = 180</span><br><span class="line">connection-control-failed-connections-threshold=5</span><br><span class="line">connection-control-min-connection-delay=600000</span><br><span class="line">audit_json_file = on</span><br><span class="line">plugin-load=AUDIT=libaudit_plugin.so</span><br></pre></td></tr></table></figure><h4 id="具有口令复杂度-1"><a href="#具有口令复杂度-1" class="headerlink" title="具有口令复杂度"></a>具有口令复杂度</h4><p>（大小写字母、数字、特殊字符），至少8位以上，180天定期更换</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">修改密码</span><br><span class="line">SET PASSWORD FOR <span class="string">'root'</span>@<span class="string">'localhost'</span> = PASSWORD(<span class="string">'Qwer49476600@qq.com'</span>);</span><br><span class="line"></span><br><span class="line">安装插件</span><br><span class="line">INSTALL PLUGIN validate_password SONAME <span class="string">'validate_password.so'</span>;</span><br><span class="line"></span><br><span class="line">sudo vim /etc/mysql/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">plugin-load-add=validate_password.so</span><br><span class="line">validate-password=ON</span><br><span class="line">validate_password_policy = 1</span><br><span class="line">validate_password_length = 8</span><br><span class="line">validate_password_mixed_case_count = 1</span><br><span class="line">validate_password_number_count = 2</span><br><span class="line">validate_password_special_char_count = 1</span><br><span class="line">default_password_lifetime = 180</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单独设置账号过期策略</span><br><span class="line">ALTER USER <span class="string">'zdjy'</span>@<span class="string">'%'</span> PASSWORD EXPIRE INTERVAL 180 DAY;</span><br><span class="line">ALTER USER <span class="string">'root'</span>@<span class="string">'%'</span> PASSWORD EXPIRE INTERVAL 180 DAY;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置全局过期策略</span><br><span class="line">SET GLOBAL default_password_lifetime = 180;</span><br><span class="line">show variables like <span class="string">'default_password_lifetime'</span>;</span><br></pre></td></tr></table></figure><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><p>root用户仅允许本地管理，zdjy用户远程管理开启SSL，且仅允许1个IP才能访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql5.7及更高版本</span><br><span class="line"></span><br><span class="line">查看是否支持ssl的连接特性</span><br><span class="line">show variables like <span class="string">"%have_ssl%"</span>或者show variables like <span class="string">"%have_openssl%"</span></span><br><span class="line"></span><br><span class="line">/etc/mysql/my.cnf配置文件里写入的require_secure_transport = ON 强制ssl配置远程访问，</span><br><span class="line">不用mysql -h 192.168.8.74 -u zdjy -p --ssl-mode=REQUIRED</span><br><span class="line"></span><br><span class="line">测试配置是否成功 mysql -h 192.168.8.74 -u zdjy -p --ssl-mode=disabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看是否启动了ssl</span><br><span class="line">SHOW VARIABLES LIKE <span class="string">'%ssl%'</span>;</span><br><span class="line"></span><br><span class="line">查看本次连接是否是ssl连接</span><br><span class="line">\s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果没有开启ssl</span><br><span class="line">1)、运行mysql_ssl_rsa_setup --uid=mysql</span><br><span class="line"></span><br><span class="line">2)、sudo systemctl restart mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/hosts.allow  </span><br><span class="line">mysqld:192.168.8.18</span><br><span class="line"></span><br><span class="line">创建zdjy账号远程管理开启ssl</span><br><span class="line">CREATE USER <span class="string">'zdjy'</span>@<span class="string">'192.168.8.18'</span> IDENTIFIED BY <span class="string">'Qwer49476600@qq.com'</span> REQUIRE SSL;</span><br><span class="line"></span><br><span class="line">允许192.168.8.18用zdjy帐户和密码来访问这个mysql server。</span><br><span class="line">grant all on *.* to zdjy@<span class="string">'192.168.8.18'</span> identified by <span class="string">'Qwer49476600@qq.com'</span> REQUIRE SSL; </span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h4 id="登录失败锁定"><a href="#登录失败锁定" class="headerlink" title="登录失败锁定"></a>登录失败锁定</h4><p>登录失败5次后锁定10分钟</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql查看、安装插件</span><br><span class="line"></span><br><span class="line">show variables like &#39;%connection_control%&#39;;</span><br><span class="line">install plugin CONNECTION_CONTROL soname &#39;connection_control.so&#39;;</span><br><span class="line">install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname &#39;connection_control.so&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;mysql&#x2F;my.cnf策略配置</span><br><span class="line">[mysqld]</span><br><span class="line">connection-control-failed-connections-threshold&#x3D;5</span><br><span class="line">connection-control-min-connection-delay&#x3D;600000    #单位是毫秒</span><br></pre></td></tr></table></figure><h4 id="开启审计策略"><a href="#开启审计策略" class="headerlink" title="开启审计策略"></a>开启审计策略</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">获取插件</span><br><span class="line">wget https://github.com/mcafee/mysql-audit/releases/download/v1.1.11/audit-plugin-mysql-5.7-1.1.11-985-linux-x86_64.zip</span><br><span class="line"><span class="comment"># linux-i686  https://github.com/mcafee/mysql-audit/releases/download/v1.1.11/audit-plugin-mysql-5.7-1.1.11-985-linux-i686.zip</span></span><br><span class="line"></span><br><span class="line">unzip audit-plugin-mysql-5.7-1.1.11-985-linux-x86_64.zip</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> audit-plugin-mysql-5.7-1.1.11-985-linux-x86_64/lib</span><br><span class="line"></span><br><span class="line">找到插件目录把so文件移动到目录下</span><br><span class="line">show variables like <span class="string">'plugin_dir'</span></span><br><span class="line">cp libaudit_plugin.so /usr/<span class="built_in">local</span>/mysql/lib/plugin/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql/lib/plugin/</span><br><span class="line"></span><br><span class="line">chmod 755 libaudit_plugin.so</span><br></pre></td></tr></table></figure><p>1、mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">install plugin AUDIT soname &#39;libaudit_plugin.so&#39;;</span><br><span class="line"></span><br><span class="line">show plugins;</span><br><span class="line"></span><br><span class="line">查看插件版本</span><br><span class="line">show global status like &#39;%audit%&#39;;</span><br></pre></td></tr></table></figure><p>2、写入配置文件持久化</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">audit_json_file &#x3D; on</span><br><span class="line">plugin-load&#x3D;AUDIT&#x3D;libaudit_plugin.so</span><br><span class="line"></span><br><span class="line"># 检查插件功能是否开启</span><br><span class="line">show variables like &#39;%audit_json_file%&#39;;</span><br></pre></td></tr></table></figure><p>3、查看日志是否有记录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可能存在于</span><br><span class="line">/usr/<span class="built_in">local</span>/mysql/data/mysql-audit.json</span><br><span class="line">/var/lib/mysql/mysql-audit.json</span><br></pre></td></tr></table></figure><p>4、配置审计制定命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># cd /app/audit-plugin-mysql-5.7-1.1.6-784/utils</span></span><br><span class="line">utils]<span class="comment"># chmod +x offset-extract.sh</span></span><br><span class="line"><span class="comment"># 执行计算偏移量的脚本前需安装此服务;</span></span><br><span class="line">utils]<span class="comment"># yum -y install gdb</span></span><br><span class="line"><span class="comment"># 计算偏移量;</span></span><br><span class="line">utils]<span class="comment"># ./offset-extract.sh /usr/local/mysql/bin/mysqld</span></span><br><span class="line">~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"><span class="comment"># 支持审计的SQL查看'http://bazaar.launchpad.net/~mysql/mysql-server/5.6/view/head:/sql/mysqld.cc#L3424'</span></span><br><span class="line">audit_record_cmds=<span class="string">'insert,update,delete,drop_db,create_db,alter_db,grant,truncate'</span></span><br><span class="line">audit_offsets=7800, 7848, 3624, 4776, 456, 360, 0, 32, 64, 160, 536, 7964, 4352, 3648, 3656, 3660, 6048, 2072, 8, 7032, 7072, 7056, 13432, 148, 672</span><br></pre></td></tr></table></figure><h3 id="Windows策略要求"><a href="#Windows策略要求" class="headerlink" title="Windows策略要求"></a>Windows策略要求</h3><blockquote><p><a href="https://www.freebuf.com/articles/network/264390.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/network/264390.html</a></p></blockquote><p>主要命令：</p><ul><li><a href="#netplwiz">netplwiz</a></li><li><a href="#lusrmgr.msc">lusrmgr.msc</a></li><li><a href="#secpol.msc">secpol.msc</a></li><li><a href="#eventvwr.msc">eventvwr.msc</a></li><li><a href="#gpedit.msc">gpedit.msc</a></li><li><a href="#services.msc">services.msc</a></li><li><a href="#cmd">cmd</a>:netstat -an、net share</li><li><a href="#firewall.cpl">firewall.cpl</a></li><li>appwiz.cpl（检查并访谈是否有多余服务）</li><li>dcomcnfg（-&gt;组件服务-&gt;计算机-&gt;我的电脑   检查并访谈是否有多余组件）<h4 id="netplwiz"><a href="#netplwiz" class="headerlink" title="netplwiz"></a>netplwiz</h4>查看是否勾选“要使用本计算机，用户必须输入用户名和密码”</li></ul><h4 id="lusrmgr-msc"><a href="#lusrmgr-msc" class="headerlink" title="lusrmgr.msc"></a>lusrmgr.msc</h4><ol><li><p>查看有哪些用户，系统默认用户adminstrator和Guest，Guest默认禁用，administrator不存在默认口令</p></li><li><p>点击用户查看是否勾选密码永不过期等信息</p></li></ol><h4 id="secpol-msc"><a href="#secpol-msc" class="headerlink" title="secpol.msc"></a>secpol.msc</h4><ul><li>本地策略-&gt;用户权限分配<ul><li>管理审核和安全日志是否包含无关用户组（默认符合）</li></ul></li><li>本地策略-&gt;安全选项  <ul><li>查看是否启用“不显示最后的用户名”策略</li><li>查看是否启用“关机：清除虚拟内存页面文件”策略</li></ul></li><li>账户策略-&gt;账户锁定策略<ul><li>采取登录失败五次锁定三十分钟；登陆超时设置为30分钟自动退出</li></ul></li><li></li></ul><h4 id="eventvwr-msc"><a href="#eventvwr-msc" class="headerlink" title="eventvwr.msc"></a>eventvwr.msc</h4><p>windows审计记录默认满足</p><ul><li>windows日志-&gt;应用程序/系统/安全-&gt;属性    日志最大大小51200KB，按需要覆盖事件</li></ul><h4 id="gpedit-msc（本地组策略编辑器）"><a href="#gpedit-msc（本地组策略编辑器）" class="headerlink" title="gpedit.msc（本地组策略编辑器）"></a>gpedit.msc（本地组策略编辑器）</h4><ul><li>管理模板–》Windows组件–》远程桌面服务–》远程桌面会话主机<ul><li>–》安全–》启用远程连接使用指定的安全层</li><li>–》会话时间限制–》启用设置活动但空闲的远程桌面服务会话的时间限制</li></ul></li></ul><h4 id="services-msc"><a href="#services-msc" class="headerlink" title="services.msc"></a>services.msc</h4><ul><li>查看多余服务例如lerter、Remote Registry Servicce Messsenger,Task Scheduler是否已启动。此处也可以查看telnet 服务是否开启</li></ul><h4 id="cmd"><a href="#cmd" class="headerlink" title="cmd"></a>cmd</h4><ul><li>netstat -an     查看高危端口开启情况（例如135,137,138,139,445,3389等</li><li>net share     查看共享开启情况   服务里把server这个服务禁用</li></ul><h4 id="firewall-cpl"><a href="#firewall-cpl" class="headerlink" title="firewall.cpl"></a>firewall.cpl</h4><ul><li>高级设置-》入站规则-》远程桌面-》用户模式（Tcp-In）-》作用域（默认未配置），先查看主机防火墙是否开启。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 等保 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 等保 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>你好</title>
      <link href="/2022/02/17/%E4%BD%A0%E5%A5%BD/"/>
      <url>/2022/02/17/%E4%BD%A0%E5%A5%BD/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="文本文字"><a href="#文本文字" class="headerlink" title="文本文字"></a>文本文字</h2>]]></content>
      
      
      
        <tags>
            
            <tag> 生活杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
